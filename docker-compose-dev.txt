# docker-compose.dev.yml
# Use this for development with hot-reload enabled

version: '3.8'

services:
  numel-app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: numel-ai-dev
    ports:
      - "8000-8010:8000-8010"
    volumes:
      # Mount source code for live editing
      - ./src:/app/src:rw
      - ./storage:/app/storage:rw
      - ./config:/app/config:rw
      # Mount HTML/JS/CSS files for frontend development
      - ./src/static:/app/src/static:rw
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONPATH=/app/src
      - ENV=development
      - RELOAD=true
    networks:
      - numel-network
    # Use watchdog for auto-restart on file changes
    command: >
      sh -c "pip install watchdog &&
             watchmedo auto-restart --directory=/app/src --pattern='*.py' --recursive --
             python /app/src/launch.py --config_path /app/config/config.json"
    stdin_open: true
    tty: true

  # SQLite is file-based, so we just ensure the volume is mounted
  # No separate SQLite container needed - it runs in the app container

  # Optional: Use this postgres service only if needed
  postgres:
    image: postgres:15-alpine
    container_name: numel-postgres-dev
    environment:
      - POSTGRES_USER=numel_dev
      - POSTGRES_PASSWORD=dev_password
      - POSTGRES_DB=numel_dev_db
    ports:
      - "5432:5432"
    volumes:
      - postgres_dev_data:/var/lib/postgresql/data
    networks:
      - numel-network
    profiles:
      - postgres

networks:
  numel-network:
    driver: bridge

volumes:
  postgres_dev_data: